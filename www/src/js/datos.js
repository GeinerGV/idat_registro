var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Datos=function(_React$Component){_inherits(Datos,_React$Component);function Datos(props){_classCallCheck(this,Datos);var _this=_possibleConstructorReturn(this,(Datos.__proto__||Object.getPrototypeOf(Datos)).call(this,props));_this.opciones=Object.keys(props.opciones);_this.state={selectedRow:0,tblHei:0,rowTipo:null,option:_this.opciones[0],cargando:false};_this.row_opcion=React.createRef();_this.getRows=_this.getRows.bind(_this);_this.getCurrRowsSource=_this.getCurrRowsSource.bind(_this);_this.handleChange=_this.handleChange.bind(_this);_this.setTableHeight=_this.setTableHeight.bind(_this);_this.getEditorPosY=_this.getEditorPosY.bind(_this);_this.handleMouseover=_this.handleMouseover.bind(_this);_this.exportarExcel=_this.exportarExcel.bind(_this);_this.handleOptionDataChange=_this.handleOptionDataChange.bind(_this);return _this}_createClass(Datos,[{key:"componentDidMount",value:function componentDidMount(){this.setTableHeight()}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps,prevState){this.setTableHeight()}},{key:"getEditorPosY",value:function getEditorPosY(){if(this.state.selectedRow&&this.state.selectedRow<this.getRows().length&&!this.state.cargando){return $("tbody tr:nth-child("+(this.state.selectedRow+1)+")").offset().top-$(".tbl-data").offset().top}return $(".tbl-data thead").height()}},{key:"getRows",value:function getRows(){var _this2=this;var ses_data=sessionStorage.getItem("data-datos");if(ses_data){ses_data=JSON.parse(ses_data);if(ses_data[this.state.option]){var keys_data=Object.keys(ses_data[this.state.option]).sort().reverse().splice(0,20);return keys_data.map(function(key){return ses_data[_this2.state.option][key]})}return null}return[]}},{key:"getCurrRowsSource",value:function getCurrRowsSource(){var ses_data=sessionStorage.getItem("data-datos");if(ses_data){ses_data=JSON.parse(ses_data);if(ses_data[this.state.option])return ses_data[this.state.option];return null}return null}},{key:"setCurrRowsSource",value:function setCurrRowsSource(rows){if((typeof rows==="undefined"?"undefined":_typeof(rows))=="object"){var ses_data=sessionStorage.getItem("data-datos");if(ses_data){ses_data=JSON.parse(ses_data);if(ses_data[this.state.option]){if(!Array.isArray(rows)){ses_data[this.state.option]=rows}else{var tmp_res={};for(row in rows){Object.assign(rows,rows[row])}}}}sessionStorage.setItem("data-datos")}}},{key:"setTableHeight",value:function setTableHeight(){var hei=$(".tbl-data").height()+17+20;if(hei!=this.state.tblHei)this.setState({tblHei:hei})}},{key:"exportarExcel",value:function exportarExcel(e){var xmlhttp=new XMLHttpRequest;var params="export_data=true&rows="+this.row_opcion.current.value;xmlhttp.onreadystatechange=function(){if(this.readyState==4&&this.status==200){$("#datos-cnt").prepend(Alerta({tipo:"success",msg:"Exportado exitosamente"}))}};xmlhttp.open("POST","/datos",true);xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");xmlhttp.send(params)}},{key:"handleChange",value:function handleChange(e){var xmlhttp=new XMLHttpRequest;var tmp_this=this;xmlhttp.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var data=JSON.parse(this.responseText);tmp_this.setState({rows:data.rows})}};xmlhttp.open("GET","/datos?data=get&json=true&rows="+e.target.value,true);xmlhttp.send()}},{key:"handleMouseover",value:function handleMouseover(e){this.setState({selectedRow:e.currentTarget.sectionRowIndex,rowTipo:"active"})}},{key:"setRowTipo",value:function setRowTipo(tipo){this.setState({rowTipo:tipo});return null}},{key:"handleOptionDataChange",value:function handleOptionDataChange(e){var option=e.target.querySelector("input").id;this.setState({option:option});var xmlhttp=new XMLHttpRequest;var params="view="+option+"&rows="+this.row_opcion.current.value+"&json=true";var this_tmp=this;this_tmp.setState({cargando:true});xmlhttp.onreadystatechange=function(){if(this.readyState==4&&this.status==200){dataManager(JSON.parse(this.responseText));this_tmp.setState({cargando:false})}};xmlhttp.open("GET","/datos?"+params,true);xmlhttp.send()}},{key:"render",value:function render(){var _this3=this;var thead=this.props.opciones[this.state.option].thead.map(function(val){return React.createElement("th",{key:val},val)});var rows=!this.state.cargando?this.getRows().map(function(row,id){return React.createElement(Row,{key:"row"+id,tipo:id==_this3.state.selectedRow?_this3.state.rowTipo:null,onMouseOver:_this3.handleMouseover,cols:row,pos:id,idAtencion:row[0]})}):React.createElement("tr",null,React.createElement("td",{className:"text-center",colSpan:thead.length},"Cargando ..."));var tblHei=this.state.tblHei;var options=this.opciones.map(function(opt){return React.createElement(OpcionesDatos,{onHandler:_this3.handleOptionDataChange,active:opt==_this3.state.option,id:opt,txt:_this3.props.opciones[opt].txt,key:opt})});return React.createElement(React.Fragment,null,React.createElement("form",{className:"form-inline",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},onSubmit:this.exportarExcel,method:"POST"},React.createElement("input",{type:"hidden",name:"export_data",value:"true"}),React.createElement("button",{type:"submit",className:"btn btn-default btn-lg"},"EXPORTAR ",React.createElement("i",{className:"glyphicon glyphicon-file"})),React.createElement("div",{className:"form-group"},React.createElement("div",{className:"btn-group","data-toggle":"buttons"},options)),React.createElement("div",{className:"form-group pull-right"},React.createElement("select",{className:"form-control",ref:this.row_opcion,onChange:this.handleChange,defaultValue:"20"},React.createElement("option",{value:"10"},"10"),React.createElement("option",{value:"20"},"20"),React.createElement("option",{value:"30"},"30")))),React.createElement("div",{className:"tbl-cnt",style:{display:"flex",maxWidth:"100wp",width:"100%"}},this.props.canEdit&&typeof AdminRows!="undefined"&&rows.length>0&&React.createElement("div",{className:"edit-tbl-row-cnt"},React.createElement(AdminRows,{posY:this.getEditorPosY(),dataRow:rows[this.state.selectedRow]})),React.createElement("div",{style:{height:tblHei+"px",width:"100%",overflowX:"overlay",overflowY:"hidden",position:"relative"}},React.createElement("table",{className:"table table-hover tbl-data",style:{position:"absolute"}},React.createElement("thead",null,React.createElement("tr",null,thead)),React.createElement("tbody",null,rows)))))}}]);return Datos}(React.Component);function Row(props){var columns=props.cols.map(function(col,id){return id==0?React.createElement("td",{key:"col"+id},props.pos+1):React.createElement("td",{key:"col"+id},col)});var optionalAttrs=props.tipo?{className:props.tipo}:{};return React.createElement("tr",Object.assign({onMouseOver:props.onMouseOver},optionalAttrs),columns)}function OpcionesDatos(props){return React.createElement("label",{className:"btn btn-"+(props.active?"warning active":"default"),onClick:props.onHandler},React.createElement("input",{type:"radio",name:"options",id:props.id})," ",props.txt)}var DATOS_REF=React.createRef();function getInitPropsDatos(){var result={rows:[]};var ses_view=sessionStorage.getItem("view-datos");if(ses_view){Object.assign(result,JSON.parse(ses_view))}return result}$(ReactDOM.render(React.createElement(Datos,Object.assign({ref:DATOS_REF},getInitPropsDatos())),document.querySelector("#datos-cnt")));
//# sourceMappingURL=datos.js.map