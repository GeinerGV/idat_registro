var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function Distrito(props){return React.createElement("option",{value:props.nombre})}var patterns={dni:"[0-9]{8}",telefono:"^(?:9\\d{8}|[0-8]\\d{6})$",distrito:function distrito(val){}};var Registro=function(_React$Component){_inherits(Registro,_React$Component);function Registro(props){_classCallCheck(this,Registro);var _this=_possibleConstructorReturn(this,(Registro.__proto__||Object.getPrototypeOf(Registro)).call(this,props));_this.state={dni:"",fullname:"",telefono:"",distrito:"",token_registros:props.token_inicial,mod_cliente:null,asesor:null};_this.handleInput=_this.handleInput.bind(_this);_this.handleSubmit=_this.handleSubmit.bind(_this);_this.iniciar=_this.iniciar.bind(_this);_this.asesor_ref=ASESOR_REF;_this.dni=React.createRef();_this.fullname=React.createRef();_this.telefono=React.createRef();_this.distrito=React.createRef();return _this}_createClass(Registro,[{key:"handleAsesorChange",value:function handleAsesorChange(){if(this.asesor_ref.current&&this.asesor_ref.current.value.trim()){$("#dni, #telefono, #fullname, #distrito").removeAttr("disabled");this.setState({asesor:this.asesor_ref.current.value.trim()})}else{$("#dni, #telefono, #fullname, #distrito").attr("disabled","true");this.setState({asesor:null})}}},{key:"searchDNI",value:function searchDNI(val){var xmlhttp=new XMLHttpRequest;var tmp_this=this;xmlhttp.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var data=JSON.parse(this.responseText);if(typeof data.dni!="undefined"){tmp_this.setState({fullname:data.fullname,distrito:data.distrito,telefono:data.telefono?data.telefono:"",mod_cliente:false});$("#fullname").val(data.fullname);$("#distrito").val(data.distrito);$("#telefono").val(data.telefono);$("#telefono, #fullname, #distrito").show();$("#telefono, #fullname, #distrito").attr("readonly","true")}else{if(typeof tmp_this.state.mod_cliente=="boolean"){tmp_this.setState({mod_cliente:null});$("#telefono, #fullname, #distrito").val("");$("#telefono, #fullname, #distrito").removeAttr("readonly")}$("#fullname").show();if($("#distrito").val())$("#distrito").show();if($("#telefono").val())$("#telefono").show()}}};xmlhttp.open("GET","/registro?client=get&json=true&dni="+val,true);xmlhttp.send()}},{key:"iniciar",value:function iniciar(){document.getElementById("form-registro").reset();$("#telefono, #fullname, #distrito").hide();this.handleAsesorChange();$(".form-group").removeClass("has-warning has-success has-error");$("#dni").focus()}},{key:"handleInput",value:function handleInput(event){var val=event.target.value;switch(event.target.id){case"dni":if(/^\d{0,8}$/.test(val)){this.setState({dni:val});if(val){if(new RegExp(patterns.dni).test(val)){setSuccess(event);this.searchDNI(val);$("#telefono, #fullname, #distrito").show()}else{setError(event);$("#telefono, #fullname, #distrito").hide()}}else{setWarning(event);$("#telefono, #fullname, #distrito").hide()}}break;case"fullname":if(/^[a-zA-Z]+(?:[ ][a-zA-Z]+)*[ ]?$|^$/.test(val)){if(val){val=val.split(" ").map(function(name){return name&&name.charAt(0).toUpperCase()+name.substring(1,val.length).toLowerCase()}).join(" ");if(val.length>=3){setSuccess(event)}else{setError(event)}}else{setWarning(event)}this.setState({fullname:val})}break;case"telefono":if(/^(?:9\d{0,8}|\d{0,7})$/.test(val)){this.setState({telefono:val});if(val){if(new RegExp(patterns.telefono).test(val)){setSuccess(event)}else{setError(event)}}else{setValidator(event,"")}}break;case"distrito":if(this.props.distritos.some(function(dist){return new RegExp("^.*"+val+".*$","i").test(dist)})){this.setState({distrito:val.toUpperCase()});if(val){if(this.props.distritos.some(function(dist){return new RegExp("^"+val+"$","i").test(dist)})){setSuccess(event)}else{setError(event)}}else{setWarning(event)}}break;}}},{key:"handleSubmit",value:function handleSubmit(event){event.preventDefault();if(this.state.dni&&this.state.fullname&&this.state.distrito){var asesor=this.asesor_ref.current.value;if(asesor){var xmlhttp=new XMLHttpRequest;var params="dni="+this.state.dni+"&token_registros="+this.state.token_registros+"&asesor="+asesor;if(this.state.fullname)params+="&fullname="+this.state.fullname.trim();if(this.state.telefono)params+="&telefono="+this.state.telefono;if(this.state.distrito)params+="&distrito="+this.state.distrito;if(this.state.mod_cliente)params+="&mod_cliente="+this.state.mod_cliente;var tmp_this=this;xmlhttp.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var data=JSON.parse(this.responseText);$(".alert").alert("close");$("#registro-cnt").prepend(Alerta(data));tmp_this.setState({token_registros:data.token});if(data.tipo=="success"){tmp_this.iniciar()}}};xmlhttp.open("POST","/registro",true);xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");xmlhttp.send(params)}}}},{key:"componentDidMount",value:function componentDidMount(){this.iniciar()}},{key:"render",value:function render(){var _React$createElement;var distritos=this.props.distritos.map(function(distrito){return React.createElement(Distrito,{nombre:distrito,key:distrito})});return React.createElement("form",{id:"form-registro",className:"form-horizontal",onSubmit:this.handleSubmit,onReset:this.iniciar},React.createElement("div",{className:"panel panel-"+this.state.panel},React.createElement("div",{className:"panel-heading"},React.createElement("h3",{className:"panel-title text-center text-uppercase"},"BIENVENIDO: ",React.createElement("strong",null,this.state.asesor))),React.createElement("div",{className:"panel-body"},React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"dni",className:"col-sm-2 control-label"},"DNI"),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"text",pattern:patterns.dni,onChange:this.handleInput,className:"form-control",ref:this.dni,id:"dni",name:"dni",placeholder:"Ingresa el DNI (i.e. 87654321)",minLength:8,maxLength:8,required:true,value:this.state.dni}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"fullname",className:"col-sm-2 control-label"},"NOMBRE Y APELLIDO"),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"text",onChange:this.handleInput,className:"form-control",ref:this.fullname,id:"fullname",name:"fullname",placeholder:"Escribe un nombre",required:true,value:this.state.fullname}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"distrito",className:"col-sm-2 control-label"},"DISTRITO"),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"text",onChange:this.handleInput,className:"form-control",list:"distritos",ref:this.telefono,id:"distrito",name:"distrito",placeholder:"\xBFD\xF3nde vives?",required:true,value:this.state.distrito}),React.createElement("datalist",{name:"distritos",id:"distritos"},distritos))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"telefono",className:"col-sm-2 control-label"},"TEL\xC9FONO"),React.createElement("div",{className:"col-sm-10"},React.createElement("input",{type:"text",onChange:this.handleInput,className:"form-control",ref:this.distrito,id:"telefono",name:"telefono",placeholder:"Digita el n\xFAmero (opcional)",pattern:patterns.telefono,minLength:7,maxLength:12,value:this.state.telefono})))),React.createElement("div",{className:"panel-footer"},React.createElement("div",{className:"btn-group btn-group-justified",role:"group","aria-label":"..."},React.createElement("div",{className:"btn-group",role:"group"},React.createElement("input",(_React$createElement={type:"hidden",name:"toke_inicial"},_defineProperty(_React$createElement,"name","token"),_defineProperty(_React$createElement,"value",this.state.token_registros),_React$createElement)),React.createElement("button",{type:"reset",id:"reset-form",className:"btn btn-default"},"LIMPIAR")),React.createElement("div",{className:"btn-group",role:"group"},React.createElement("button",{type:"submit",className:"btn btn-primary"},"GRABAR"))))))}}]);return Registro}(React.Component);var RegistroManager=function(_React$Component2){_inherits(RegistroManager,_React$Component2);function RegistroManager(props){_classCallCheck(this,RegistroManager);var _this2=_possibleConstructorReturn(this,(RegistroManager.__proto__||Object.getPrototypeOf(RegistroManager)).call(this,props));_this2.state={distritos:[],token_inicial:""};return _this2}_createClass(RegistroManager,[{key:"componentDidMount",value:function componentDidMount(){var tmp_this=this;var xmlhttp=new XMLHttpRequest;xmlhttp.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var data=JSON.parse(this.responseText);tmp_this.setState({distritos:data.distritos})}};xmlhttp.open("GET","/registro?distritos=get&json=true",true);xmlhttp.send();var xmlhttp2=new XMLHttpRequest;xmlhttp2.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var data=JSON.parse(this.responseText);tmp_this.setState({token_inicial:data.token})}};xmlhttp2.open("GET","/registro?token=get&json=true",true);xmlhttp2.send()}},{key:"render",value:function render(){return React.createElement(Registro,Object.assign({},this.state,{key:this.state.token_inicial,ref:REGISTRO_REF}))}}]);return RegistroManager}(React.Component);$(ReactDOM.render(React.createElement(RegistroManager,null),document.querySelector("#registro-cnt")));
//# sourceMappingURL=registro.js.map